<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.wzpmc.filemanager.dao.FileDao">
    <insert id="uploadFile" useGeneratedKeys="true" keyProperty="id">
        insert into `files`(`fileName`, `fileSize`, `fileFormat`, `md5`, `uploader`, `upload_time`)
            values(#{fileName}, #{fileSize}, #{fileFormat}, #{md5}, #{uploader}, now());
    </insert>
    <delete id="deleteFile">
        delete from `files` where `id` = #{id};
    </delete>

    <select id="getFileCount" resultType="java.lang.Long">
        select count(*) from `files`;
    </select>
    <select id="getFiles" resultType="cn.wzpmc.filemanager.entities.FileObject">
        select * from `files` limit #{id}, 20;
    </select>
    <select id="searchFilesById" resultType="cn.wzpmc.filemanager.entities.FileObject">
        select * from `files` where `id` = #{keywords};
    </select>
    <select id="searchFilesByName" resultType="cn.wzpmc.filemanager.entities.FileObject">
        select * from `files` where `fileName` like #{keywords} limit #{id}, 20;
    </select>
    <select id="searchFilesByMd5" resultType="cn.wzpmc.filemanager.entities.FileObject">
        select * from `files` where `md5` like #{keywords} limit #{id}, 20;
    </select>
    <select id="searchFilesByFormat" resultType="cn.wzpmc.filemanager.entities.FileObject">
        select * from `files` where `fileFormat` like #{keywords} limit #{id}, 20;
    </select>
    <select id="countSearchFilesByName" resultType="java.lang.Integer">
        select count(*) from `files` where `fileName` like #{keywords};
    </select>
    <select id="countSearchFilesByMd5" resultType="java.lang.Integer">
        select count(*) from `files` where `fileName` like #{keywords};
    </select>
    <select id="countSearchFilesByFormat" resultType="java.lang.Integer">
        select count(*) from `files` where `fileFormat` like #{keywords};
    </select>
    <select id="getFileInfo" resultType="cn.wzpmc.filemanager.entities.FileObject">
        select `md5`,`fileName`,`fileFormat`,`fileSize` from `files` where `id` = #{id};
    </select>
    <select id="getFullFileInfo" resultType="cn.wzpmc.filemanager.entities.FileObject">
        select * from `files` where `id` = #{id};
    </select>
</mapper>